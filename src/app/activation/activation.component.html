<section class="background-threads careers-threads" id="top">
  <div class="fade-in-section disable-fade-in is-visible fade-in-hero disable-transform">
    <div class="container hero-splash-container">
      <div class="row pv90-60">
        <div class="col-sm-12 col-md-8 hero-splash">
          <h1 class="hero-title" style="color: white">{{ 'activation.choose' | translate }}</h1>
        </div>
        <div class="col-12"></div>
        <div class="col-sm-12 col-md-5"></div>
      </div>
    </div>
  </div>
</section>
<div class="border-top-black is-visible">
  <section class="content-section-mobile background-white pt-5 mb60 pb60"  style="margin: 0 auto; top: 5%; overflow-x: auto; height: 100vh;">
    <div class="m-5 mb-3">
      <h4 class="mb-3" style="text-align: center">
        {{ 'activation.complete' | translate }}
      </h4><br>
      <div [formGroup]="criteriaFrom" (ngSubmit)="onSubmit()">
        <div style="display: flex; flex-direction: row; flex-wrap: wrap; justify-content: space-around;">
          <div formArrayName="criteres" style="text-align: center; width: 80vw;">
            <div *ngFor="let preference of getPreferences().controls; index as i">
              <div [formGroup]="preference" style="display: flex; flex-direction: row;
              flex-wrap:wrap; justify-content: center">
                <div class="mb-1 mr-3">
                  <label for="sectors" *ngIf="i === 0 && !isSmallScreen" style="font-size: 18px; font-family: 'GT America Extended'">{{ 'subscribe.sectors' | translate }}(s): </label><br>
                  <div class="mb-5" *ngIf="i === 0"></div>
                  <p-dropdown id="sectors" [options]="sectors" optionLabel="Name"
                              [filter]="true" filterBy="Name" optionValue="id"
                              placeholder="{{ 'subscribe.sectors' | translate }}" formControlName="filieres">
                    <ng-template let-sector pTemplate="item">
                      <div>{{sector.Name}}</div>
                    </ng-template>
                  </p-dropdown>
                </div>

                <div class="mb-1 mr-3">
                  <label for="markets" *ngIf="i === 0 && !isSmallScreen" style="font-size: 18px; font-family: 'GT America Extended'">{{ 'subscribe.markets' | translate }}(s): </label><br>
                  <div class="mb-5" *ngIf="i === 0"></div>
                  <p-dropdown id="markets" [options]="markets" optionLabel="Nom"
                              [filter]="true" filterBy="Nom" optionValue="id"
                              placeholder="{{ 'subscribe.markets' | translate }}" formControlName="marches">
                    <ng-template let-market pTemplate="item">
                      <div>{{market.Nom}}</div>
                    </ng-template>
                  </p-dropdown>
                </div>

                <div class="mb-1 mr-3">
                  <label for="themes" *ngIf="i === 0 && !isSmallScreen" style="font-size: 18px; font-family: 'GT America Extended'">{{ 'subscribe.themes' | translate }}(s): </label><br>
                  <div class="mb-5" *ngIf="i === 0"></div>
                  <p-dropdown id="themes" [options]="themes" optionLabel="Nom"
                              [filter]="true" filterBy="Nom" optionValue="id"
                              placeholder="{{ 'subscribe.themes' | translate }}" formControlName="themes">
                    <ng-template let-theme pTemplate="item">
                      <div>{{theme.Nom}}</div>
                    </ng-template>
                  </p-dropdown>
                </div>

                <div>
                  <div class="mb-5" *ngIf="i === 0"></div>
                  <button pButton pRipple type="button" label="x"
                          class="p-button-raised p-button-danger" style="margin-top: 27px"
                          [style.border-radius.px]="0" (click)="deletePreferences(i)"></button>
                </div>
              </div>
            </div>
            <div class="mt-5">
              <button pButton pRipple type="button" label="{{ 'activation.add' | translate }}"
                      class="p-button-raised p-button-success add-button"
                      [style.border-radius.px]="0" (click)="addPreferences()"></button>
            </div>
            <div style="display: flex; flex-direction: row; flex-wrap: nowrap; justify-content: center" class="mt-5">
              <button pButton (click)="onSubmit()" *ngIf="!criteriaFrom.invalid && !(this.criteriaFrom.controls.criteres.value.length === 0)"
                      [style.border-radius.px]="0"
                      label="{{ 'subscribe.send' | translate }}" icon="pi pi-arrow-right"
                      iconPos="right" class="p-button-lg p-button-outlined p-button-secondary search-input"></button>
              <p-progressSpinner class="ml-4" [style]="{height: '60px'}" *ngIf="processing"></p-progressSpinner>
            </div>
          </div>
        </div>
      </div>
    </div>

    <p-dialog header="{{ 'activation.header' | translate }}" [(visible)]="done"
              [modal]="true" [closable]="false"
              [breakpoints]="{'960px': '75vw', '640px': '95vw'}"
              [style]="{ width: '50vw'}" [baseZIndex]="10000"
              [draggable]="false">
      <p>{{ 'activation.done' | translate }}</p>
      <ng-template pTemplate="footer">
        <p-button (click)="redirectTo()" label="Ok" styleClass="p-button-text"></p-button>
      </ng-template>
    </p-dialog>

    <p-dialog header="{{ 'activation.header-error' | translate }}" [(visible)]="error"
              [modal]="true" [closable]="false"
              [breakpoints]="{'960px': '75vw', '640px': '95vw'}"
              [style]="{ width: '50vw'}" [baseZIndex]="10000"
              [draggable]="false">
      <p>{{ 'activation.error' | translate }}</p>
      <ng-template pTemplate="footer">
        <p-button (click)="redirectTo()" label="Ok" styleClass="p-button-text"></p-button>
      </ng-template>
    </p-dialog>
  </section>
</div>
